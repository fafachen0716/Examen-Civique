<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Examen Civique ‚Äì Quiz</title>
<link rel="icon" href="data:,">

<style>
:root{
  --primary:#6366f1;
  --success:#22c55e;
  --danger:#ef4444;
  --bg:#f4f6fb;
  --card:#fff;
  --text:#1f2937;
}
.title {
  white-space: nowrap;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,system-ui,sans-serif;
  background:var(--bg);
  color:var(--text);
}

.container{
  max-width:900px;
  margin:auto;
  padding:16px;
}

.card{
  background:var(--card);
  border-radius:16px;
  padding:20px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
  margin-bottom:16px;
}

/* Header */
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  flex-wrap:wrap;
}

.meta{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
.meta span{
  background:#eef2ff;
  padding:6px 12px;
  border-radius:999px;
  font-size:14px;
  font-weight:500;
}

.status{
  text-align:right;
  font-weight:600;
  color:var(--primary);
}

/* Buttons */
.btn{
  border:none;
  border-radius:14px;
  padding:14px;
  width:100%;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
  background:var(--primary);
  color:#fff;
  box-shadow:0 6px 16px rgba(99,102,241,.35);
  transition:.15s;
}
.btn:hover{transform:translateY(-2px)}
.btn:active{transform:scale(.97)}

/* Options */
.options{display:grid;gap:12px}
.option{
  background:#f9fafb;
  padding:14px;
  border-radius:14px;
  border:2px solid transparent;
  cursor:pointer;
  transition:.2s;
}
.option:hover{
  background:#eef2ff;
  border-color:var(--primary);
}
.option.correct{
  background:#dcfce7;
  border-color:var(--success);
  animation:pop .3s ease;
}
.option.wrong{
  background:#fee2e2;
  border-color:var(--danger);
  animation:shake .35s ease;
}

/* Explanation */
.explanation{
  margin-top:16px;
  padding:14px;
  border-left:5px solid var(--primary);
  background:#f8fafc;
  border-radius:12px;
  animation:fadeUp .3s ease;
}

@keyframes pop{
  0%{transform:scale(.95)}
  100%{transform:scale(1)}
}
@keyframes shake{
  0%{transform:translateX(0)}
  25%{transform:translateX(-4px)}
  50%{transform:translateX(4px)}
  75%{transform:translateX(-4px)}
  100%{transform:translateX(0)}
}
@keyframes fadeUp{
  from{opacity:0;transform:translateY(10px)}
  to{opacity:1;transform:translateY(0)}
}

@media(max-width:600px){
  h1{font-size:22px}
}

/* ===== Croissant Rain ===== */
.food {
  position: fixed;
  top: -40px;
  font-size: 28px;
  pointer-events: none;
  animation: fall linear forwards;
  z-index: 9999;
}

@keyframes fall {
  to {
    transform: translateY(110vh) rotate(360deg);
    opacity: 0.9;
  }
}

</style>
</head>

<body>
<div class="container">

<!-- START -->
<div id="start" class="card">
  <h1 class="title">ü•ñ Je r√©vise bien mon examen civique ü•ê</h1>
  <button class="btn" onclick="startExam('CSP')">Commencer CSP</button>
  <br><br>
  <button class="btn" onclick="startExam('CR')" style="background:#9ca3af;box-shadow:none">CR (bient√¥t)</button>
</div>

<!-- QUIZ -->
<div id="quiz" style="display:none">

  <div class="card header">
    <div class="meta" id="meta"></div>
    <div class="status">
      <div id="progress"></div>
      <div id="timer"></div>
    </div>
  </div>

  <div class="card">
    <h2 id="question"></h2>
    <div class="options" id="options"></div>
    <div id="explanation"></div>
  </div>

  <button id="nextBtn" class="btn" style="display:none" onclick="nextQuestion()">Suivant</button>
</div>

</div>

<script>
let examType='';
let questions=[];
let index=0;
let score=0;
let timeLeft=45*60;
let timer;
function shuffle(array){
  for(let i = array.length - 1; i > 0; i--){
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}
function prepareQuestions(data){
  const grouped = {};

  data.forEach(q => {
    if(!grouped[q.part]) grouped[q.part] = [];
    grouped[q.part].push(q);
  });

  questions = [];

  Object.keys(grouped).forEach(part => {
    shuffle(grouped[part]);
    questions = questions.concat(grouped[part].slice(0, 8));
  });

  shuffle(questions); // Êâì‰∫Ç 40 È°åÈ†ÜÂ∫è
}



function startExam(type){
  if(type==='CR'){
    alert('CR est en pr√©paration.');
    return;
  }
  examType=type;
  fetch('csp.json')
  .then(r => r.json())
  .then(data => {
    prepareQuestions(data);   // ‚úÖ ÈáçÈªûÂú®ÈÄô
    document.getElementById('start').style.display='none';
    document.getElementById('quiz').style.display='block';
    startTimer();
    showQuestion();
  });
}

function showQuestion(){
  const q=questions[index];
  document.getElementById('meta').innerHTML=
    `<span>Category: ${q.category}</span> <span>Part: ${q.part}</span>`;
  document.getElementById('progress').innerText=
    `Question ${index+1} / ${questions.length}`;
  document.getElementById('question').innerText=q.question;
  document.getElementById('explanation').innerHTML='';
  document.getElementById('nextBtn').style.display='none';

  const opt=document.getElementById('options');
  opt.innerHTML='';
  Object.entries(q.options).forEach(([k,v])=>{
    const div=document.createElement('div');
    div.className='option';
    div.innerText=`${k}. ${v}`;
    div.onclick=()=>selectAnswer(div,k);
    opt.appendChild(div);
  });
}

function selectAnswer(el,answer){
  const q=questions[index];
  document.querySelectorAll('.option').forEach(o=>o.onclick=null);

  if(answer===q.correctAnswer){
    el.classList.add('correct');
    score++;
    croissantRain(); // ü•êü•ñüéâ

  }else{
    el.classList.add('wrong');
    document.querySelectorAll('.option').forEach(o=>{
      if(o.innerText.startsWith(q.correctAnswer)) o.classList.add('correct');
    });
  }

  document.getElementById('explanation').innerHTML=
    `<div class="explanation"><strong>Explication :</strong><br>${q.explanation}</div>`;

  document.getElementById('nextBtn').style.display='block';
}

function nextQuestion(){
  index++;
  if(index>=questions.length){
    clearInterval(timer);
    if(index >= questions.length){
      clearInterval(timer);

      const passed = score >= 32;
      const message = passed
        ? 'üéâ Vous pouvez demander la carte de r√©sident.'
        : '‚ùå Bon courage pour la prochaine fois.';

      alert(
        `R√©sultat : ${score} / 40\n\n${message}`
      );

      location.reload();
    }
  }else{
    showQuestion();
  }
}

function startTimer(){
  timer=setInterval(()=>{
    const m=Math.floor(timeLeft/60);
    const s=timeLeft%60;
    document.getElementById('timer').innerText=
      `${m}:${s<10?'0':''}${s}`;
    timeLeft--;
    if(timeLeft<0){
      clearInterval(timer);
      alert('Temps √©coul√©');
    }
  },1000);
}


function croissantRain(count = 25){
  const emojis = ['ü•ê', 'ü•ñ'];

  for(let i = 0; i < count; i++){
    const span = document.createElement('span');
    span.className = 'food';
    span.innerText = emojis[Math.floor(Math.random() * emojis.length)];

    span.style.left = Math.random() * 100 + 'vw';
    span.style.animationDuration = (2 + Math.random() * 2) + 's';
    span.style.fontSize = (22 + Math.random() * 20) + 'px';

    document.body.appendChild(span);

    setTimeout(() => span.remove(), 4000);
  }
}

</script>
</body>
</html>
